---
title: Настройки хоста
---

# Настройки хоста

Настройки хоста позволяют вам настраивать параметры входящих соединений. С помощью этого раздела вы можете создавать отдельные конфигурации для каждого входящего соединения.

## Редактируемые поля

- **Remark**: Примечание или описание для данной конфигурации хоста.

- **Address**: IP-адрес или домен, который будет использоваться для этого входящего соединения. По умолчанию используется IP-адрес сервера.

- **Port**: Порт, который будет использоваться для этого входящего соединения.

- **SNI**: Server Name Indication - имя сервера, которое будет использоваться для TLS-соединения.

- **Host**: Имя хоста, которое будет использоваться для соединения.

- **Security Layer**: Уровень безопасности соединения (например, TLS).

- **ALPN**: Application-Layer Protocol Negotiation - протоколы, которые будут использоваться для соединения.

- **Fingerprint**: Отпечаток TLS, который будет использоваться для соединения.

- **Fragment pattern**: Шаблон фрагментации для обхода блокировок.

- **Noise pattern**: Шаблон шума для UDP-соединений.

- **Allow Insecure**: Разрешить небезопасные соединения.

- **Mux**: Включить мультиплексирование соединений.

- **Random UserAgent**: Использовать случайный User-Agent.

## Приоритет настроек

Поля, установленные в настройках хоста, имеют приоритет над другими конфигурациями. Это означает, что если вы установите значение для поля в настройках хоста, оно будет использоваться вместо значения по умолчанию или значения, установленного в других местах.

## Пользовательские конфигурации

Некоторые функции, такие как Fragment, Noise, Allow Insecure, Mux и Random UserAgent, требуют использования пользовательских конфигураций в клиентах. Для использования этих функций необходимо:

1. В V2rayN: Включить "Использовать пользовательскую конфигурацию" в настройках.
2. В V2rayNG: Установить переменную окружения `V2RAYA_USE_CUSTOM_CONFIG=1`.
3. В Streisand: Включить "Использовать пользовательскую конфигурацию" в настройках.

## Шаблоны Fragment и Noise

### Fragment
Шаблон Fragment используется для обхода фильтров. Примеры допустимых шаблонов:
```
none
tlshello
http
```

### Noise
Шаблон Noise используется для управления UDP-соединениями. Примеры допустимых шаблонов:
```
none
normal
video
```

::: tip Примечание
В настоящее время эти функции поддерживаются только в клиентах V2rayN, V2rayNG и Streisand.
:::

## Примечания

::: tip Первое примечание
Настройки хоста имеют более высокий приоритет по сравнению с другими настройками. Поля, настроенные в этом разделе, применяются с наивысшим приоритетом при генерации конфигураций.
:::

::: tip Второе примечание
Если вы хотите использовать значения `Fragment`, `Noise`, `Allow Insecure`, `Mux`, `Random UserAgent`, вы должны использовать пользовательскую конфигурацию.
:::

## Пользовательская конфигурация
Если вы хотите использовать пользовательскую конфигурацию Marzban, следуйте этим шагам:
- Сначала обновите вашу панель до последней версии.
- Добавьте следующие значения в `env.`:

Для клиентов `V2rayN`, `V2rayNG`, `Streisand`:
```env
USE_CUSTOM_JSON_FOR_V2RAYN=True
USE_CUSTOM_JSON_FOR_V2RAYNG=True
USE_CUSTOM_JSON_FOR_STREISAND=True
```
Для всех клиентов:
```env
USE_CUSTOM_JSON_DEFAULT=True
```
- Затем перезапустите Marzban, чтобы применить изменения.

### Шаблон Fragment

**Применение**: Fragment позволяет подключаться к заблокированному домену путем отправки пакетов по частям.

**Правильный шаблон**: `length,interval,packets`

**Примеры**:

`100-200,10-20,tlshello`

`100-200,10-20,1-3`

::: warning Внимание
В настоящее время эта функция поддерживается только в клиенте iPhone `Streisand` версии `1.6.12` и клиенте Android `v2rayNG` версии `1.8.16` для пользовательской конфигурации.
:::

### Шаблон Noise

**Применение**: Файрвол проверяет первый запрос для разрешения `udp` пакетов. Если это `udp`, он его отбрасывает, но с шумом первый запрос будет неопределенным, в результате чего мы подключаемся к `udp` протоколам, таким как `shadowsocks`, `wireguard`, трансмиссия `splithttp`, а также `quic`.

**Правильный шаблон**: `packets,delay`

**Примеры**:

`rand:10-20,10-20`

`rand:10-20,10-20&base64:7nQBAAABAAAAAAAABnQtcmluZwZtc2VkZ2UDbmV0AAABAAE=,10-25`

::: warning Внимание
В настоящее время эта функция поддерживается только в клиенте iPhone `Streisand` версии `1.6.32` и клиенте Android `v2rayNG` версии `1.8.39` для пользовательской конфигурации.
:::

### Allow Insecure

**Применение**: Подключение без реального сертификата

### Mux

**Применение**: Использование Fragment увеличит пинг до определенной степени, и с помощью `MUX` вы можете поддерживать пинг на стабильном уровне.

### Random User Agent

**Применение**: При включении этой переменной User-Agent будет случайным, что несколько снижает вероятность блокировки и полезно для прокси `noTLS`.

## Переменные
Для максимальной настройки конфигураций для каждого поля разработаны переменные. В каждом поле необходимо использовать переменные, соответствующие этому полю.

::: warning Внимание
Обратите внимание, что переменные должны быть заключены в `{` и `}` в полях.
:::

### Remark

| Имя переменной  | Описание                                                   |
| -------------- | ---------------------------------------------------------- |
| `{SERVER_IP}`  | IPv4 адрес сервера                                         |
| `{USERNAME}`   | Имя пользователя                                           |
| `{DATA_USAGE}` | Использованный трафик пользователя                         |
| `{DATA_LEFT}`  | Оставшийся трафик пользователя                            |
| `{DATA_LIMIT}` | Общий лимит трафика пользователя                          |
| `{DAYS_LEFT}`  | Оставшиеся дни подписки пользователя                      |
| `{STATUS_TEXT}`| Статус пользователя в виде текста (настраиваемый), например: Active, Expired и т.д. |
| `{STATUS_EMOJI}`| Статус пользователя в виде эмодзи, например: ✅,⌛️       |
| `{PROTOCOL}`   | Протокол конфигурации, например: VMess, VLESS, Trojan и т.д. |
| `{TRANSPORT}`  | Метод транспорта конфигурации, например: ws, tcp и т.д.    |


Например:

| Поле remark                                             | Вывод                            |
| ------------------------------------------------------ | ------------------------------- |
| (\{STATUS_EMOJI\} Сервер 1 (\{USERNAME\}) [\{PROTOCOL\} - \{TRANSPORT\}] | ✅ Сервер 1 (user102) [VMess - ws] |
| Осталось \{DAYS_LEFT\} дней                            | Осталось 24 дня                 |
| Использовано: \{DATA_LEFT\}/\{DATA_LIMIT\}             | Использовано: 16.5GB/30GB       |


### Address

| Имя переменной  | Описание                                                   |
| -------------- | ---------------------------------------------------------- |
| `{SERVER_IP}`  | IPv4 адрес сервера                                         |
| `{USERNAME}`   | Имя пользователя                                           |
| `{DATA_USAGE}` | Использованный трафик пользователя                         |
| `{DATA_LEFT}`  | Оставшийся трафик пользователя                            |
| `{DATA_LIMIT}` | Общий лимит трафика пользователя                          |
| `{DAYS_LEFT}`  | Оставшиеся дни подписки пользователя                      |
| `{STATUS_TEXT}`| Статус пользователя в виде текста (настраиваемый), например: Active, Expired и т.д. |
| `{STATUS_EMOJI}`| Статус пользователя в виде эмодзи, например: ✅,⌛️       |
| `{PROTOCOL}`   | Протокол конфигурации, например: VMess, VLESS, Trojan и т.д. |
| `{TRANSPORT}`  | Метод транспорта конфигурации, например: ws, tcp и т.д.    |

## Настройка пользовательского текста для Status Text
Для настройки пользовательского текста для `Status Text` измените следующие значения по желанию и поместите их в `env.`:
```
ACTIVE_STATUS_TEXT = "Active"
EXPIRED_STATUS_TEXT = "Expired"
LIMITED_STATUS_TEXT = "Limited"
DISABLED_STATUS_TEXT = "Disabled"
ONHOLD_STATUS_TEXT = "On-Hold"
```

## Создание случайного выражения

В некоторых случаях необходимо, чтобы части полей SNI и Host генерировались случайным образом. Эта техника иногда используется для предотвращения большого количества подключений к определенному поддомену. В этом случае каждый пользователь подключается к случайному поддомену.

Чтобы использовать эту функцию, используйте символ `*` в полях SNI и Host.


::: warning Примечание
Обратите внимание, что в этом случае должны быть выполнены настройки для wildcard домена.
:::


Например:

| Поле host или SNI      | Пример сгенерированного выражения в конфигурации для этих полей |
| ---------------------- | --------------------------------------------------- |
| `*.example.com`        | 32ks0ef23402.example.com                            |
| `access-*.example.com` | access-laks038fn201.example.com                     |

### Несколько Host и SNI

Если необходимо настроить несколько разных адресов для Host и SNI, вы можете разделить эти адреса с помощью `,`. Для каждого пользователя будет случайным образом выбран один из этих адресов. 