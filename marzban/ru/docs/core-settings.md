---
title: Основные настройки
---

# Основные настройки

Поскольку панель Marzban основана на `Xray-core`, данный документ призван объяснить практические аспекты `Xray`, которые вы можете использовать в разделе `Core Settings` панели, чтобы вы были знакомы с его полезными функциями.

## DNS

Чтобы настроить `DNS` в разделе `Core Settings` панели Marzban, просто добавьте следующий раздел в начало.

```json{5-10} [xray-config.json]
{
  "log": {
    "loglevel": "info"
  },
  "dns": {
    "servers": [
      "1.1.1.1"
    ],
    "queryStrategy": "UseIPv4"
  },
  "inbounds": [
```

В приведённом примере используется DNS от Cloudflare. Ниже приведена таблица с различными типами DNS и их назначением.

|  Тип `DNS`     |     Провайдер      |      Назначение                                                  |
| -------------- | ------------------ | --------------------------------------------------------------- |
| `1.1.1.1`      | `Cloudflare`       | Скорость, конфиденциальность и безопасность                      |
| `1.1.1.3`      | `Cloudflare`       | Блокировка порнографического контента, подходит для семейного использования |
| `1.1.1.2`      | `Cloudflare`       | Блокировка вредоносных программ                                  |
| `1.0.0.2`      | `Cloudflare`       | Блокировка порнографического контента и вредоносных программ       |
| `8.8.8.8`      | `Google`           | Надёжность благодаря глобальной сети сервисов Google              |
| `8.8.4.4`      | `Google`           | Резервный DNS для основного DNS-сервиса от Google                  |
| `9.9.9.9`      | `Quad9`            | Фокусируется на безопасности и блокировке доступа к вредоносным доменам |
| `208.67.222.222` | `OpenDNS`        | Защита от фишинга и возможность настройки параметров               |      
| `208.67.222.123` | `OpenDNS`        | Блокировка порнографического контента, подходит для семейного использования |

## Inbounds

Раздел `Inbounds` в `Xray-core` определяет, как прокси-сервис обрабатывает входящие подключения. Каждый `Inbound` задаёт прослушиватель, который принимает подключения на назначенном порту и применяет к ним определённые протоколы или правила для управления ими.

Inbounds, указанные в разделе `Core Settings`, определяют прокси в Marzban. Входящие подключения управляются на основе этого раздела. Список практичных inbounds можно найти в документе: [Xray Inbounds](https://gozargah.github.io/marzban/en/docs/xray-inbounds).

- Далее мы проанализируем различные разделы одного inbound.

::: details VLESS TCP REALITY
::: code-group
```json
{
  "tag": "VLESS TCP REALITY",
  "listen": "0.0.0.0",
  "port": 443,
  "protocol": "vless",
  "settings": {
    "clients": [],
    "decryption": "none"
  },
  "streamSettings": {
    "network": "tcp",
    "tcpSettings": {},
    "security": "reality",
    "realitySettings": {
      "show": false,
      "dest": "google.com:443",
      "xver": 0,
      "serverNames": [
        "example.com",
        ""
      ],
      "privateKey": "oNDJxLaAiXojgAcdW5gzwuQB_gMYL0DXfRnqswUKvTE",
      "publicKey": "oVRY8h7Njgw25j3CNhaJVMUys378tTvecrSRbrB3gyo"
      "shortIds": [
        "2ebd6e17dec6a5d9"
      ]
    }
  },
  "sniffing": {
    "enabled": true,
    "destOverride": [
      "http",
      "tls",
      "quic"
    ]
  }
}
```
:::

::: tip tag
```json
"tag": "VLESS TCP REALITY"
```
Тег используется для идентификации конкретного inbound. Он помогает отличать inbounds, особенно в сложных конфигурациях или при наличии нескольких inbound, что облегчает их управление.
::: 

::: tip listen
```json
"listen": "0.0.0.0"
```
IP-адрес, на котором `Xray-Core` будет принимать подключения. Адрес `0.0.0.0` означает, что `Xray-Core` слушает все доступные IP-адреса сервера.
::: 

::: tip port
```json
"port": 443
```
Сетевой порт, на котором `Xray-Core` должен принимать подключения. Порт `443` обычно используется для HTTPS-трафика и здесь применяется для протокола `VLESS`.
::: 

::: tip protocol
```json
"protocol": "vless"
```
Протокол, используемый для этого inbound, — `vless`, современный и безопасный протокол передачи данных.
::: 

::: tip settings
```json
"settings": {
  "clients": [],
  "decryption": "none"
}
```

Этот раздел содержит специфические настройки для протокола `vless`.

- Раздел `clients` перечисляет авторизованных пользователей, которым разрешено подключаться.

- Раздел `decryption` указывает метод дешифрования.
::: 

::: tip streamSettings
```json
"streamSettings": {
  "network": "tcp",
  "tcpSettings": {},
  "security": "reality",
  "realitySettings": {
    "show": false,
    "dest": "google.com:443",
    "xver": 0,
    "serverNames": [
      "example.com",
      ""
    ],
    "privateKey": "oNDJxLaAiXojgAcdW5gzwuQB_gMYL0DXfRnqswUKvTE",
    "publicKey": "oVRY8h7Njgw25j3CNhaJVMUys378tTvecrSRbrB3gyo",
    "shortIds": [
      "2ebd6e17dec6a5d9"
    ]
  }
}
```
Настройки, связанные с потоками и сетевыми протоколами:

- Раздел `network` указывает тип сети для передачи данных. Здесь выбран `tcp`.

- Раздел `tcpSettings` содержит специфические настройки TCP. Он пуст, что означает использование настроек по умолчанию.

- Раздел `security` указывает тип защиты, используемой для данного подключения, в данном случае — `Reality`. Reality — технология для повышения безопасности.

- Раздел `realitySettings` включает специальные настройки для технологии Reality.

- Параметр `show` определяет, следует ли отображать информацию об этом подключении. Значение `false` означает, что информация не будет отображаться.

- Параметр `dest` задаёт конечное назначение, используемое для имитации или обфускации, здесь установлено как `google.com:443`.

- Параметр `xver` указывает версию протокола, где 0 означает начальную версию.

- Раздел `serverNames` содержит список имён серверов, который должен включать домен, который вы планируете использовать.

- Параметр `privateKey` содержит приватный ключ для шифрования и безопасности, являющийся длинным случайным ключом.

- Параметр `publicKey` используется для шифрования информации и является общедоступным. Он может использоваться для шифрования данных.

- Раздел `shortIds` содержит короткие идентификаторы для уникальной идентификации, включающие случайный ID.

- Обратите внимание, что включение `publicKey` в настройки inbound не обязательно. При наличии `privateKey` Marzban автоматически сгенерирует `publicKey` для вашего прокси. Здесь он приведён исключительно для пояснения различных разделов этого inbound.
::: 

::: tip sniffing
```json
"sniffing": {
  "enabled": true,
  "destOverride": [
    "http",
    "tls",
    "quic"
  ]
}
```
Настройки перехвата трафика (sniffing):

- Параметр `enabled` указывает, включён ли перехват трафика. Значение `true` означает, что он включён.

- Раздел `destOverride` содержит список протоколов, которые игнорируются при перехвате трафика, включая `http`, `tls` и `quic`.

- Игнорирование указанных протоколов означает, что `Xray-Core` обрабатывает их напрямую, без глубокого анализа и имитации трафика, что может повысить эффективность и упростить управление трафиком, снижая нагрузку на систему.
::: 

## Outbounds

Разделы `Outbounds` и `Routing` тесно связаны и определяют, как управлять и направлять трафик. Раздел `Routing` использует правила (`Rules`), чтобы определить, как следует обрабатывать различные типы трафика, в то время как раздел `Outbounds` указывает назначения или конкретные прокси, через которые направляется трафик.

Такой интегрированный подход позволяет гибко и динамично управлять трафиком, обеспечивая точный контроль над его направлением. Раздел `Outbounds` определяет доступные назначения или прокси, включая информацию об их протоколах и настройках. Каждый `Outbound` идентифицируется уникальным тегом.

<br>

::: tip freedom
Протокол `freedom` разработан для обхода цензуры или ограничений маршрутизации в определённых сетевых условиях. Это полезный инструмент в Xray-core, который обеспечивает неограниченный доступ в Интернет, позволяя трафику свободно протекать без вмешательства промежуточных сетевых слоёв.
::: 

```json
    {
      "protocol": "freedom",
      "settings": {},
      "tag": "DIRECT"
    },
```
<br>

::: tip blackhole
Протокол `blackhole` действует как «чёрная дыра» для пакетов, отбрасывая трафик без обработки или ответа. Вы можете использовать его для специальных целей.
::: 

```json
    {
      "protocol": "blackhole",
      "settings": {},
      "tag": "BLOCK"
    },
```
<br>

::: tip IPv4
Например, добавив следующий `Outbound`, вы можете отдать приоритет использованию IPv4, чтобы избежать ошибок `403` на различных платформах. Протокол `freedom` вероятно уже включён в ваши outbounds; если это так, просто добавьте к нему раздел `settings`.
::: 

```json
  "outbounds": [
    {
      "protocol": "freedom",
      "settings": {
        "domainStrategy": "ForceIPv4"
      },
      "tag": "direct"
    },
```

## Routing & Rules

Как уже упоминалось, в `Xray-core` раздел `Routing` вместе с правилами включает различные настройки, определяющие, как управлять входящим трафиком и куда его направлять.

Если посмотреть на приведённый ниже пример, то видно, что мы использовали `Routing` для направления запросов к определённым доменам на outbound с тегом `BLOCK`, который использует протокол `blackhole`. В результате запросы к этим сайтам не достигнут своего назначения.

```json
{
  "domain": [
    "www.speedtest.net",
    "fast.com"
  ],
  "outboundTag": "BLOCK",
  "type": "field"
},
``` 
