---
title: Настройки ядра
---

# Настройки ядра

Поскольку панель Marzban основана на ядре `Xray`, в этой документации мы постараемся объяснить полезные настройки `Xray`, которые вы можете использовать в разделе `Core Settings` панели, чтобы вы были знакомы с его практическими аспектами.

## DNS

- Чтобы настроить `DNS` в разделе `Core Settings` Marzban, достаточно добавить следующий раздел в начало:

```json{5-10} [xray-config.json]
{
  "log": {
    "loglevel": "info"
  },
  "dns": {
    "servers": [
      "1.1.1.1"
    ],
    "queryStrategy": "UseIPv4"
  },
  "inbounds": [
```

- В приведенном выше примере мы использовали `DNS` Cloudflare. Ниже приведены различные типы `DNS` и их применение:

| Тип `DNS`         | Провайдер        | Применение                                                    |
| ---------------- | ---------------- | ------------------------------------------------              |
| `1.1.1.1`        | `Cloudflare`     | Скорость, конфиденциальность и безопасность                  |
| `1.1.1.3`        | `Cloudflare`     | Блокировка контента для взрослых, подходит для семейного использования |
| `1.1.1.2`        | `Cloudflare`     | Блокировка вредоносного ПО                                  |
| `1.0.0.2`        | `Cloudflare`     | Блокировка вредоносного ПО и контента для взрослых          |
| `8.8.8.8`        | `Google`         | Надежный благодаря глобальным сервисам Google               |
| `8.8.4.4`        | `Google`         | Резервный `DNS` Google                                      |
| `9.9.9.9`        | `Quad9`          | Фокус на безопасности и блокировке вредоносных доменов      |
| `208.67.222.222` | `OpenDNS`        | Защита от фишинга и настраиваемые параметры                 |      
| `208.67.222.123` | `OpenDNS`        | Блокировка контента для взрослых, подходит для семейного использования |


## Inbounds

Раздел `Inbounds` в ядре `Xray` определяет, как прокси-сервис принимает входящие соединения. Каждый `Inbound` определяет слушатель (listener), который принимает соединения на определенном порту и применяет определенные протоколы или правила для их обработки.

Inbound'ы, которые мы размещаем в `Core Settings`, определяют наши прокси в панели Marzban, и наши входящие соединения относятся к этому разделу. Список полезных inbound'ов приведен в документации [Входящие соединения Xray](https://gozargah.github.io/marzban/ru/docs/xray-inbounds).

- Давайте рассмотрим различные части inbound'а:

::: details VLESS TCP REALITY
::: code-group
```json
{
  "tag": "VLESS TCP REALITY",
  "listen": "0.0.0.0",
  "port": 443,
  "protocol": "vless",
  "settings": {
    "clients": [],
    "decryption": "none"
  },
  "streamSettings": {
    "network": "tcp",
    "tcpSettings": {},
    "security": "reality",
    "realitySettings": {
      "show": false,
      "dest": "google.com:443",
      "xver": 0,
      "serverNames": [
        "example.com",
        ""
      ],
      "privateKey": "oNDJxLaAiXojgAcdW5gzwuQB_gMYL0DXfRnqswUKvTE",
      "publicKey": "oVRY8h7Njgw25j3CNhaJVMUys378tTvecrSRbrB3gyo"
      "shortIds": [
        "2ebd6e17dec6a5d9"
      ]
    }
  },
  "sniffing": {
    "enabled": true,
    "destOverride": [
      "http",
      "tls",
      "quic"
    ]
  }
}
```
:::

::: tip tag
```json
"tag": "VLESS TCP REALITY"
```
Тег (Tag) используется для идентификации этого конкретного inbound'а. Этот тег помогает вам легче идентифицировать их в сложных конфигурациях и когда у вас есть несколько разных inbound'ов.
:::

::: tip listen
```json
"listen": "0.0.0.0"
```
IP-адрес, который `Xray-Core` должен прослушивать. `0.0.0.0` означает, что `Xray-Core` будет прослушивать все доступные IP-адреса на сервере.
:::

::: tip port
```json
"port": 443
```
Сетевой порт, который `Xray-Core` должен прослушивать. Порт `443` обычно используется для `HTTPS` трафика и здесь настроен как вход для протокола `VLESS`.
:::

::: tip protocol
```json
"protocol": "vless"
```
Протокол, используемый для inbound'а. В данном случае это протокол `vless`, который является одним из современных и безопасных протоколов для передачи данных.
:::

::: tip settings
```json
"settings": {
  "clients": [],
  "decryption": "none"
}
```
Этот раздел содержит специфические настройки протокола `vless`.

- Раздел `clients` - список авторизованных пользователей для подключения

- Раздел `decryption` - метод расшифровки
:::

::: tip streamSettings
```json
"streamSettings": {
  "network": "tcp",
  "tcpSettings": {},
  "security": "reality",
  "realitySettings": {
    "show": false,
    "dest": "google.com:443",
    "xver": 0,
    "serverNames": [
      "example.com",
      ""
    ],
    "privateKey": "oNDJxLaAiXojgAcdW5gzwuQB_gMYL0DXfRnqswUKvTE",
    "publicKey": "oVRY8h7Njgw25j3CNhaJVMUys378tTvecrSRbrB3gyo",
    "shortIds": [
      "2ebd6e17dec6a5d9"
    ]
  }
}
```
Настройки для потока и сетевых протоколов

- Раздел `network` - тип сети, используемый для передачи данных. Здесь выбран `tcp`.

- Раздел `tcpSettings` - специфические настройки `TCP`. Здесь пустой, что означает использование настроек по умолчанию.

- Раздел `security` - тип безопасности, используемый для этого соединения. `Reality` означает использование технологии `Reality` для повышения безопасности.

- Раздел `realitySettings` - специфические настройки для технологии `Reality`.

- Раздел `show` - определяет, должна ли отображаться информация об этом соединении. `false` означает не отображать.

- Раздел `dest` - конечный пункт назначения, используемый для эмуляции или маскировки. Здесь установлен `google.com:443`.

- Раздел `xver` - версия протокола, где 0 означает начальную версию.

- Раздел `serverNames` - список имен серверов, куда нужно поместить ваш домен.

- Раздел `privateKey` - приватный ключ для шифрования и обеспечения безопасности, представляющий собой длинный случайный ключ.

- Раздел `publicKey` - публичный ключ, используемый для шифрования информации. Этот ключ публично доступен и может использоваться для шифрования данных.

- Раздел `shortIds` - короткие идентификаторы для уникальной идентификации, включающие случайный идентификатор.

- Относительно раздела `publickey` имейте в виду, что его наличие в inbound'е не обязательно. Достаточно указать только `privatekey`, и Marzban сам создаст `publickey` в вашем прокси. Мы включили его здесь только для объяснения различных частей этого inbound'а.
:::

::: tip sniffing
```json
"sniffing": {
  "enabled": true,
  "destOverride": [
    "http",
    "tls",
    "quic"
  ]
}
```
Настройки для определения трафика (sniffing)

- Раздел `enabled` - включение или отключение определения трафика. `true` означает включено.

- Раздел `destOverride` - протоколы, которые игнорируются при определении трафика, включая `http`, `tls`, `quic`.

- В разделе `destOverride` игнорирование протоколов означает, что `Xray-Core` обрабатывает их напрямую вместо глубокого анализа и эмуляции трафика этих протоколов. Это может помочь улучшить производительность и упростить управление трафиком, одновременно уменьшая необходимость сложной обработки для некоторых протоколов, чтобы снизить использование системных ресурсов.
:::


## Outbounds

Разделы `Outbounds` и `Routing` тесно связаны между собой для определения того, как управлять и направлять трафик. Раздел `Routing` с помощью `Rules` или правил определяет, как должны обрабатываться различные типы трафика, в то время как раздел `Outbounds` определяет фактические пункты назначения или прокси, куда направляется трафик.

Этот интегрированный подход позволяет вам гибко и динамично управлять трафиком и обеспечивает точный контроль над тем, как и куда направляется трафик. Раздел `Outbounds` определяет доступные пункты назначения или прокси, включая детали протокола и их конфигурацию. Каждый `Outbound` идентифицируется уникальным тегом.

<br>

::: tip freedom
Протокол `freedom` или протокол свободы разработан для обхода цензуры или ограничений маршрутизации в определенных сетевых средах. Это полезный инструмент в Xray-core, который помогает обеспечить неограниченный доступ к интернету, позволяя трафику свободно проходить без вмешательства промежуточных сетевых слоев.
:::

```json
    {
      "protocol": "freedom",
      "settings": {},
      "tag": "DIRECT"
    },
```
<br>

::: tip blackhole
Протокол `blackhole` фактически действует как "черная дыра" для пакетов, эффективно удаляя трафик без обработки или ответа, что вы можете использовать для определенных целей.
:::

```json
    {
      "protocol": "blackhole",
      "settings": {},
      "tag": "BLOCK"
    },
```
<br>

::: tip IPv4
Например, добавив следующий `Outbound`, вы можете приоритезировать использование `IPv4`, чтобы избежать ошибки `403` на различных платформах. Вероятно, протокол `freedom` уже есть в вашем outbound'е, в этом случае просто добавьте к нему раздел `settings`.
:::

```json
  "outbounds": [
    {
      "protocol": "freedom",
      "settings": {
        "domainStrategy": "ForceIPv4"
      },
      "tag": "direct"
    },
```

## Routing & Rules

Как упоминалось ранее, в ядре `Xray` раздел `Routing` или маршрутизация и правила включает различные настройки, которые определяют, как должен обрабатываться входящий трафик и куда он должен быть направлен.

- Если посмотреть на пример ниже, с помощью `Routing` мы отправили выбранные домены на outbound с тегом `BLOCK`, который использует протокол `blackhole`, и в результате запросы к этим сайтам не достигнут пункта назначения.

```json
{
  "domain": [
    "www.speedtest.net",
    "fast.com"
  ],
  "outboundTag": "BLOCK",
  "type": "field"
},
``` 